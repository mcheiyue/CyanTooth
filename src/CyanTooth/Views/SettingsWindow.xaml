<ui:FluentWindow x:Class="BluetoothManager.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:vm="clr-namespace:BluetoothManager.ViewModels"
        mc:Ignorable="d"
        Title="设置 - CyanTooth"
        Width="500" Height="600"
        MinWidth="450" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" Title="设置"/>

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" Padding="24,16">
            <StackPanel>
                <!-- General Section -->
                <TextBlock Text="常规" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,12"/>
                
                <ui:CardExpander Header="启动" Icon="{ui:SymbolIcon Power24}" Margin="0,0,0,8">
                    <StackPanel Margin="8">
                        <ui:ToggleSwitch Content="启动时最小化到托盘"
                                        IsChecked="{Binding StartMinimized}"/>
                        <ui:ToggleSwitch Content="开机自启动"
                                        IsChecked="{Binding RunAtStartup}"
                                        Margin="0,8,0,0"/>
                    </StackPanel>
                </ui:CardExpander>

                <!-- Appearance Section -->
                <TextBlock Text="外观" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,12"/>
                
                <ui:CardControl Header="主题" Icon="{ui:SymbolIcon PaintBrush24}" Margin="0,0,0,8">
                    <ComboBox Width="150"
                             ItemsSource="{Binding AvailableThemes}"
                             SelectedItem="{Binding SelectedTheme, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Path=.}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </ui:CardControl>

                <ui:CardControl Header="在托盘显示电量" Icon="{ui:SymbolIcon Battery224}" Margin="0,0,0,8">
                    <ui:ToggleSwitch IsChecked="{Binding ShowBatteryInTray}"/>
                </ui:CardControl>

                <!-- Notifications Section -->
                <TextBlock Text="通知" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,12"/>

                <ui:CardControl Header="连接状态变化" Icon="{ui:SymbolIcon PlugConnected24}" Margin="0,0,0,8">
                    <ui:ToggleSwitch IsChecked="{Binding ShowConnectionNotifications}"/>
                </ui:CardControl>

                <ui:CardControl Header="低电量警告" Icon="{ui:SymbolIcon BatteryWarning24}" Margin="0,0,0,8">
                    <ui:ToggleSwitch IsChecked="{Binding ShowLowBatteryNotifications}"/>
                </ui:CardControl>

                <ui:CardControl Header="低电量阈值" Icon="{ui:SymbolIcon Gauge24}" Margin="0,0,0,8">
                    <ComboBox Width="100"
                             ItemsSource="{Binding BatteryThresholdOptions}"
                             SelectedItem="{Binding LowBatteryThreshold, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Run Text="{Binding Path=., Mode=OneWay}"/><Run Text="%"/>
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </ui:CardControl>

                <!-- Advanced Section -->
                <TextBlock Text="高级" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,12"/>

                <ui:CardControl Header="电量轮询间隔" Icon="{ui:SymbolIcon Timer24}" Margin="0,0,0,8">
                    <ComboBox Width="120"
                             ItemsSource="{Binding PollIntervalOptions}"
                             SelectedItem="{Binding BatteryPollInterval, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Run Text="{Binding Path=., Mode=OneWay}"/><Run Text=" 秒"/>
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </ui:CardControl>

                <!-- About Section -->
                <TextBlock Text="关于" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,12"/>

                <ui:Card Margin="0,0,0,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <ui:SymbolIcon Grid.Column="0" Symbol="Bluetooth24" FontSize="40" Margin="0,0,16,0"/>

                        <StackPanel Grid.Column="1">
                            <TextBlock Text="CyanTooth" FontWeight="SemiBold" FontSize="16"/>
                            <TextBlock Text="版本 1.0.0" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Text="Windows 现代蓝牙设备管理工具"
                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                      TextWrapping="Wrap"
                                      Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </ui:Card>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="2" 
               BorderThickness="0,1,0,0" 
               BorderBrush="{DynamicResource ControlElevationBorderBrush}"
               Padding="24,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <ui:Button Grid.Column="1" 
                          Content="重置" 
                          Command="{Binding ResetCommand}"
                          Appearance="Secondary"
                          Margin="0,0,8,0"/>
                
                <ui:Button Grid.Column="2" 
                          Content="保存" 
                          Command="{Binding SaveCommand}"
                          Appearance="Primary"
                          Click="Save_Click"/>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>
